
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="机器学习与嵌入式开发笔记">
      
      
      
      
        <link rel="prev" href="../%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E4%B8%8E%E9%80%9A%E4%BF%A1/">
      
      
        <link rel="next" href="../%E9%98%9F%E5%88%97%E9%9B%86/">
      
      
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>队列 - 个人技术与学习笔记</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="个人技术与学习笔记" class="md-header__button md-logo" aria-label="个人技术与学习笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            个人技术与学习笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              队列
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="个人技术与学习笔记" class="md-nav__button md-logo" aria-label="个人技术与学习笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    个人技术与学习笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    机器学习 (Machine Learning)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    机器学习 (Machine Learning)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Pytorch 学习
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Pytorch 学习
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/nn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    nn 神经网络
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/tensor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tensor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    data 数据处理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/transfrom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    transform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/tensorboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tensorboard 可视化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/Test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Notebook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    电赛软件 (Embedded Software)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    电赛软件 (Embedded Software)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E8%B5%9B%E8%BD%AF%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ARM 架构
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    ARM 架构
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARM%E6%9E%B6%E6%9E%84/ARM%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ARM 架构概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARM%E6%9E%B6%E6%9E%84/ARM%20Cortex-M%20CPU%20%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ARM Cortex-M CPU 架构
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARM%E6%9E%B6%E6%9E%84/%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    通用寄存器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARM%E6%9E%B6%E6%9E%84/%E7%89%B9%E6%AE%8A%E5%AF%84%E5%AD%98%E5%99%A8xPSR/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    特殊寄存器xPSR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    RTOS 实时操作系统
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    RTOS 实时操作系统
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../RTOS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务堆栈
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务切换
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    FreeRTOS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    FreeRTOS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FreeRTOS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FreeRTOS 简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%BB%BB%E5%8A%A1%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务创建和删除
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务调度
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%BB%BB%E5%8A%A1%E9%80%9A%E7%9F%A5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务通知
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    内存管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E4%B8%8E%E9%80%9A%E4%BF%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    同步、互斥与通信
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    队列
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E9%98%9F%E5%88%97%E9%9B%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    队列集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%B8%AD%E6%96%AD%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    中断管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%A7%BB%E6%A4%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    移植
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    STM32 HAL 库
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    STM32 HAL 库
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/STM32%20HAL%E5%BA%93/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    库介绍
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/GPIO%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPIO 操作
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/NVIC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NVIC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/DMA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DMA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/ADC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/%E5%AE%9A%E6%97%B6%E5%99%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    定时器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/FLASH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FLASH
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/BKP%26RTC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BKP & RTC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/WDG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WDG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/%E7%A1%AC%E4%BB%B6%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    硬件通信协议
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    通信协议
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    通信协议
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/I2C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I2C
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/SPI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SPI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/USART/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    USART
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/CAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CAN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    电控算法
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    电控算法
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/PID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/LQR/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LQR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/SMC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    视觉应用
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    视觉应用
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%A7%86%E8%A7%89/%E8%A7%86%E8%A7%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    视觉
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%A7%86%E8%A7%89/Micropython%20%26%20K230/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Micropython & K230
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<div class="toc">
<ul>
<li><a href="#_1">队列的基本概念与特性</a></li>
<li><a href="#_2">传输数据的方法</a></li>
<li><a href="#_3">队列的阻塞访问</a><ul>
<li><a href="#_4">写队列</a></li>
<li><a href="#_5">优先级</a></li>
<li><a href="#_6">读队列</a></li>
</ul>
</li>
<li><a href="#_7">队列基本</a><ul>
<li><a href="#queuehandle_t">QueueHandle_t</a></li>
<li><a href="#queue_t">Queue_t</a></li>
<li><a href="#_8">阻塞唤醒</a><ul>
<li><a href="#_9">核心思想：硬件定时器 + 排序列表</a></li>
<li><a href="#1">1. 关键数据结构</a><ul>
<li><a href="#a">a) 两个重要的列表</a></li>
<li><a href="#b">b) 核心变量</a></li>
</ul>
</li>
<li><a href="#2">2. 超时唤醒的实现流程</a><ul>
<li><a href="#_10">阶段一：任务设置阻塞并启动超时倒计时</a></li>
<li><a href="#_11">阶段二：系统心跳中断进行超时检查</a></li>
</ul>
</li>
<li><a href="#3">3. 超时与事件同时到达的竞争处理</a></li>
<li><a href="#_12">总结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#freertos">FreeRTOS</a><ul>
<li><a href="#_13">队列创建函数</a><ul>
<li><a href="#xqueuecreate-">xQueueCreate - 动态创建队列</a></li>
<li><a href="#xqueuecreatestatic-">xQueueCreateStatic - 静态创建队列</a></li>
</ul>
</li>
<li><a href="#_14">队列复位与删除函数</a><ul>
<li><a href="#vqueuereset-">vQueueReset - 队列复位</a></li>
<li><a href="#vqueuedelete-">vQueueDelete - 队列删除</a></li>
</ul>
</li>
<li><a href="#_15">队列写入函数</a><ul>
<li><a href="#xqueuesend-fifo">xQueueSend - 后端发送（标准FIFO）</a></li>
<li><a href="#xqueuesendtofront-lifo">xQueueSendToFront - 前端发送（LIFO）</a></li>
<li><a href="#xqueuesendtoback-">xQueueSendToBack - 后端发送</a></li>
<li><a href="#xqueueoverwrite-">xQueueOverwrite - 覆盖写入</a></li>
<li><a href="#_16">中断安全写入函数</a><ul>
<li><a href="#xqueuesendfromisr">xQueueSendFromISR</a></li>
<li><a href="#xqueuesendtofrontfromisr">xQueueSendToFrontFromISR</a></li>
<li><a href="#xqueueoverwritefromisr">xQueueOverwriteFromISR</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_17">队列读取函数</a><ul>
<li><a href="#xqueuereceive-">xQueueReceive - 接收并移除数据</a></li>
<li><a href="#xqueuepeek-">xQueuePeek - 查看但不移除数据</a></li>
<li><a href="#_18">中断安全读取函数</a><ul>
<li><a href="#xqueuereceivefromisr">xQueueReceiveFromISR</a></li>
<li><a href="#xqueuepeekfromisr">xQueuePeekFromISR</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_19">队列查询函数</a><ul>
<li><a href="#uxqueuemessageswaiting-">uxQueueMessagesWaiting - 查询消息数量</a></li>
<li><a href="#uxqueuespacesavailable-">uxQueueSpacesAvailable - 查询剩余空间</a></li>
<li><a href="#_20">中断安全查询函数</a><ul>
<li><a href="#uxqueuemessageswaitingfromisr">uxQueueMessagesWaitingFromISR</a></li>
</ul>
</li>
<li><a href="#_21">查询函数使用示例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cmsisv2-api">CMSISv2 API</a><ul>
<li><a href="#osmessagequeuenew-">osMessageQueueNew - 创建消息队列</a></li>
<li><a href="#osmessagequeueput-">osMessageQueuePut - 发送消息</a></li>
<li><a href="#osmessagequeueget-">osMessageQueueGet - 接收消息</a></li>
<li><a href="#_22">其他队列管理函数</a><ul>
<li><a href="#osmessagequeuegetcount">osMessageQueueGetCount</a></li>
<li><a href="#osmessagequeuegetspace">osMessageQueueGetSpace</a></li>
<li><a href="#osmessagequeuedelete">osMessageQueueDelete</a></li>
<li><a href="#osmessagequeuereset">osMessageQueueReset</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_23">队列使用最佳实践总结</a><ul>
<li><a href="#_24">队列设计原则</a></li>
<li><a href="#_25">错误处理策略</a></li>
<li><a href="#_26">性能优化建议</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_1">队列的基本概念与特性</h1>
<p>队列(queue)是FreeRTOS中最基础的任务间通信机制，可以用于"任务到任务"、"任务到中断"、"中断到任务"直接传输信息。具有以下核心特性：</p>
<p><strong>先进先出(FIFO)</strong>：数据按照发送的顺序依次被接收，保证数据顺序性</p>
<p><strong>线程安全</strong>：多个任务可以同时向队列读写数据而不会产生数据竞争</p>
<p><strong>数据拷贝</strong>：队列在传递数据时进行完整的数据复制，而非传递指针</p>
<p><strong>阻塞机制</strong>：当队列空时读取任务可以阻塞等待，队列满时写入任务可以阻塞等待</p>
<p><strong>多任务同步</strong>：天然支持生产者-消费者模式的任务同步</p>
<p><strong>基础</strong></p>
<ul>
<li>队列可以包含若干个数据：队列中有若干项，这被称为"长度"(length)</li>
<li>每个数据大小固定</li>
<li>创建队列时就要指定长度、数据大小</li>
<li>数据的操作采用先进先出的方法(FIFO，First In First Out)：写数据时放到尾部，读数据时从头部读</li>
<li>也可以强制写队列头部：覆盖头部数据</li>
</ul>
<h1 id="_2">传输数据的方法</h1>
<p>使用队列传输数据时有两种方法：</p>
<ul>
<li>拷贝：把数据、把变量的值复制进队列里</li>
<li>引用：把数据、把变量的地址复制进队列里</li>
</ul>
<p>FreeRTOS使用拷贝值的方法，这更简单：</p>
<ul>
<li>局部变量的值可以发送到队列中，后续即使函数退出、局部变量被回收，也不会影响队列中的数据</li>
<li>无需分配buffer来保存数据，队列中有buffer</li>
<li>局部变量可以马上再次使用</li>
<li>发送任务、接收任务解耦：接收任务不需要知道这数据是谁的、也不需要发送任务来释放数据</li>
<li>如果数据实在太大，你还是可以使用队列传输它的地址</li>
<li>队列的空间有FreeRTOS内核分配，无需任务操心</li>
<li>对于有内存保护功能的系统，如果队列使用引用方法，也就是使用地址，必须确保双方任务对这个地址都有访问权限。使用拷贝方法时，则无此限制：内核有足够的权限，把数据复制进队列、再把数据复制出队列。</li>
</ul>
<h1 id="_3">队列的阻塞访问</h1>
<p>只要知道队列的句柄，谁都可以读、写该队列。任务、ISR都可读、写队列。可以多个任务读写队列。</p>
<p>任务读写队列时，简单地说：如果读写不成功，则阻塞；可以指定超时时间。口语化地说，就是可以定个闹钟：如果能读写了就马上进入就绪态，否则就阻塞直到超时。</p>
<h2 id="_4">写队列</h2>
<p>某个任务读队列时，如果队列没有数据，则该任务可以进入阻塞状态：还可以指定阻塞的时间。如果队列有数据了，则该阻塞的任务会变为就绪态。如果一直都没有数据，则时间到之后它也会进入就绪态。</p>
<h2 id="_5">优先级</h2>
<p>既然读取队列的任务个数没有限制，那么当多个任务读取空队列时，这些任务都会进入阻塞状态：有多个任务在等待同一个队列的数据。当队列中有数据时，哪个任务会进入就绪态？</p>
<ul>
<li>优先级最高的任务</li>
<li>如果大家的优先级相同，那等待时间最久的任务会进入就绪态</li>
</ul>
<h2 id="_6">读队列</h2>
<p>跟读队列类似，一个任务要写队列时，如果队列满了，该任务也可以进入阻塞状态：还可以指定阻塞的时间。如果队列有空间了，则该阻塞的任务会变为就绪态。如果一直都没有空间，则时间到之后它也会进入就绪态。</p>
<p>既然写队列的任务个数没有限制，那么当多个任务写"满队列"时，这些任务都会进入阻塞状态：有多个任务在等待同一个队列的空间。当队列中有空间时，哪个任务会进入就绪态？</p>
<ul>
<li>优先级最高的任务</li>
<li>如果大家的优先级相同，那等待时间最久的任务会进入就绪态</li>
</ul>
<h1 id="_7">队列基本</h1>
<h2 id="queuehandle_t"><code>QueueHandle_t</code></h2>
<p>队列句柄类型，指向队列控制块的指针。</p>
<h2 id="queue_t"><code>Queue_t</code></h2>
<p>队列控制块类型。</p>
<pre><code class="language-c">typedef struct QueueDefinition
{
    // ---------------- 存储区管理 ----------------
    int8_t *pcHead;           // 指向队列存储区的起始地址（队列开始）
    int8_t *pcTail;           // 指向队列存储区的结束地址的下一个字节（队列结束之后）
    int8_t *pcWriteTo;        // 指向下一个写入数据的位置

    // ---------------- 读取位置管理 ----------------
    union
    {
        int8_t *pcReadFrom;   // 当用作队列时，指向下一个读取数据的位置
        UBaseType_t uxRecursiveCallCount; // 当用作互斥量时，用于递归调用计数
    } u;

    // ---------------- 任务等待列表（核心同步机制） ----------------
    // 当任务因读取（接收）而阻塞时，会挂到这个列表上（例如：队列空）
    List_t xTasksWaitingToReceive;
    // 当任务因写入（发送）而阻塞时，会挂到这个列表上（例如：队列满）
    List_t xTasksWaitingToSend;

    // ---------------- 队列状态信息 ----------------
    volatile UBaseType_t uxMessagesWaiting; // 当前队列中已有的消息数量
    UBaseType_t uxLength;                   // 队列创建时设定的最大长度（项目数）
    UBaseType_t uxItemSize;                 // 每个项目的大小（字节数）

    // ---------------- 类型标识 ----------------
    // 标识这个队列对象的类型：队列、互斥量、信号量等。
    // 这允许同一个内核函数（如 xQueueGenericSend）处理多种对象。
    int8_t cRxLock;          // 从队列接收时使用的锁计数（在中断中）
    int8_t cTxLock;          // 向队列发送时使用的锁计数（在中断中）

    #if ( ( configSUPPORT_STATIC_ALLOCATION == 1 ) &amp;&amp; ( configSUPPORT_DYNAMIC_ALLOCATION == 1 ) )
        uint8_t ucStaticallyAllocated; // 标识队列内存是静态还是动态分配的
    #endif

    #if ( configUSE_QUEUE_SETS == 1 )
        // 如果启用队列集，这个指针用于将队列与一个队列集关联
        struct QueueDefinition *pxQueueSetContainer;
    #endif

    #if ( configUSE_TRACE_FACILITY == 1 )
        UBaseType_t uxQueueNumber; // 用于跟踪调试的队列编号
        uint8_t ucQueueType;       // 用于跟踪调试的队列类型
    #endif

} Queue_t;
</code></pre>
<h2 id="_8">阻塞唤醒</h2>
<p>非常好！FreeRTOS 的超时唤醒机制是其实时性的核心保障之一，它的实现非常精巧。这个机制<strong>不仅仅用于队列，而是用于所有可能引起任务阻塞的场合</strong>，如信号量、事件组、任务通知等。</p>
<hr />
<h3 id="_9">核心思想：硬件定时器 + 排序列表</h3>
<p>FreeRTOS 利用一个硬件定时器（通常是 SysTick）作为心跳，并维护了一个<strong>按超时时间排序的列表</strong>，称为 <strong>"等待未到期列表"</strong> 或 <strong>"延时列表"</strong>。</p>
<hr />
<h3 id="1">1. 关键数据结构</h3>
<h4 id="a">a) 两个重要的列表</h4>
<ol>
<li>
<p><strong><code>xDelayedTaskList1</code> 和 <code>xDelayedTaskList2</code></strong></p>
<ul>
<li>这两个列表<strong>按唤醒时间（超时到期时间）排序</strong>，时间最近的排在前面。</li>
<li>为什么要两个列表？这是为了在系统心跳中断中进行安全的列表切换，一个给内核使用（<code>pxDelayedTaskList</code>），另一个给中断使用（<code>pxOverflowDelayedTaskList</code>），用于处理系统滴答计数器溢出的情况。从应用程序视角，我们可以将它们视为一个整体的“延时列表”。</li>
</ul>
</li>
<li>
<p><strong><code>xPendingReadyList</code></strong></p>
<ul>
<li>这是一个“挂起就绪列表”。当任务因为超时或事件发生而需要被解除阻塞，但解除操作发生在<strong>中断服务程序</strong>中时，任务不会被直接移到就绪列表（因为不能在中断中进行调度决策），而是先放到这个列表中。</li>
</ul>
</li>
</ol>
<h4 id="b">b) 核心变量</h4>
<ul>
<li><strong><code>xTickCount</code></strong>：</li>
<li>这是系统的<strong>心跳计数器</strong>，每次硬件定时器中断发生，它就加一。它是整个系统的时间基准。</li>
<li><strong><code>xNextTaskUnblockTime</code></strong>：</li>
<li>这是一个<strong>全局优化变量</strong>，记录了<strong>整个系统中下一个将要超时的任务的时间点</strong>。</li>
<li>这个变量至关重要，它告诉调度器：“在 <code>xNextTaskUnblockTime</code> 之前，绝对不会有任务因超时而醒来”。这意味着在 <code>xNextTaskUnblockTime</code> 之前，调度器可以放心地让 CPU 进入低功耗的 IDLE 状态。</li>
</ul>
<hr />
<h3 id="2">2. 超时唤醒的实现流程</h3>
<p>整个过程可以分为 <strong>“设置阻塞”</strong> 和 <strong>“超时检查”</strong> 两个阶段。</p>
<h4 id="_10">阶段一：任务设置阻塞并启动超时倒计时</h4>
<p>当一个任务（例如 <code>Task_A</code>）调用 <code>xQueueReceive(..., 100ms)</code> 时，如果队列为空，它会进入阻塞状态。内核会执行以下操作：</p>
<ol>
<li>
<p><strong>计算唤醒时间点</strong>：</p>
<ul>
<li><code>xWakeTime = xTickCount + pdMS_TO_TICKS(100)</code></li>
<li>将当前时间 <code>xTickCount</code> 加上超时时间，计算出未来的唤醒时间点 <code>xWakeTime</code>。</li>
</ul>
</li>
<li>
<p><strong>将任务挂入延时列表</strong>：</p>
<ul>
<li>将 <code>Task_A</code> 从<strong>就绪列表</strong>中移除。</li>
<li>根据计算出的 <code>xWakeTime</code>，将 <code>Task_A</code> 按照顺序插入到 <strong>延时列表</strong> 中。这个列表是按 <code>xWakeTime</code> <strong>升序排列</strong>的。</li>
</ul>
</li>
<li>
<p><strong>更新下一个唤醒时间</strong>：</p>
<ul>
<li>由于 <code>Task_A</code> 被插入到延时列表，内核会检查它是否成为了列表中超时时间最早的任务（即是否在列表首部）。</li>
<li>如果是，则更新全局变量 <code>xNextTaskUnblockTime</code> 为 <code>Task_A</code> 的 <code>xWakeTime</code>。</li>
</ul>
</li>
</ol>
<pre><code class="language-mermaid">flowchart TD
    A[&quot;Task_A 调用&lt;br/&gt;xQueueReceive(..., 100ms)&quot;] --&gt; B{&quot;队列是否为空?&quot;}
    B -- 是 --&gt; C[&quot;计算唤醒时间点&lt;br/&gt;xWakeTime = xTickCount + 100ms&quot;]
    C --&gt; D[&quot;将 Task_A 从就绪列表移除&quot;]
    D --&gt; E[&quot;将 Task_A 按 xWakeTime&lt;br/&gt;排序插入延时列表&quot;]
    E --&gt; F{&quot;Task_A 是否成为&lt;br/&gt;最早超时的任务?&quot;}
    F -- 是 --&gt; G[&quot;更新 xNextTaskUnblockTime = xWakeTime&quot;]
    F -- 否 --&gt; H[&quot;xNextTaskUnblockTime 不变&quot;]
    G &amp; H --&gt; I[&quot;任务切换: 调度其他就绪任务&quot;]
    B -- 否 --&gt; J[&quot;立即成功返回&quot;]
</code></pre>
<h4 id="_11">阶段二：系统心跳中断进行超时检查</h4>
<p>每次 SysTick 定时器中断发生时，<code>xTaskIncrementTick()</code> 函数会被调用。它负责：</p>
<ol>
<li>
<p><strong>递增时间基准</strong>：</p>
<ul>
<li><code>xTickCount = xTickCount + 1</code></li>
</ul>
</li>
<li>
<p><strong>检查是否到达超时时间</strong>：</p>
<ul>
<li>它比较当前的 <code>xTickCount</code> 和 <code>xNextTaskUnblockTime</code>。</li>
<li><strong>如果 <code>xTickCount &lt; xNextTaskUnblockTime</code></strong>：说明还没有任务需要被唤醒，直接返回。</li>
<li><strong>如果 <code>xTickCount &gt;= xNextTaskUnblockTime</code></strong>：说明<strong>至少有一个</strong>任务超时时间已到。</li>
</ul>
</li>
<li>
<p><strong>唤醒超时任务</strong>：</p>
<ul>
<li>内核遍历<strong>延时列表</strong>，将所有 <code>xWakeTime &lt;= xTickCount</code> 的任务都从列表中移除。</li>
<li>对于每个被移除的任务：<ul>
<li><strong>如果它在等待一个资源（如队列）</strong>：说明它是因为<strong>超时</strong>而醒来，而不是因为等到了数据。因此，内核会将它从该资源的等待列表（如队列的 <code>xTasksWaitingToReceive</code>）中也移除掉。</li>
<li><strong>将任务重新放回就绪列表</strong>。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>更新下一个唤醒时间</strong>：</p>
<ul>
<li>在处理完所有超时任务后，延时列表的新头部（如果列表不为空）就是下一个要超时的任务。</li>
<li>更新 <code>xNextTaskUnblockTime</code> 为这个新头部的超时时间。如果列表为空，则 <code>xNextTaskUnblockTime</code> 被设置为一个最大值，表示“没有任务在等待超时”。</li>
</ul>
</li>
</ol>
<hr />
<h3 id="3">3. 超时与事件同时到达的竞争处理</h3>
<p>一个关键问题是：如果一个任务在等待队列数据，同时超时时间也到了，会怎样？</p>
<ul>
<li><strong>事件（数据到达）先于超时</strong>：<ul>
<li>另一个任务发送了数据，内核将 <code>Task_A</code> 从队列的等待列表和延时列表中<strong>同时移除</strong>，并放入就绪列表。<code>Task_A</code> 成功获得数据。</li>
</ul>
</li>
<li><strong>超时先于事件</strong>：<ul>
<li>SysTick 中断发现 <code>Task_A</code> 超时，将其从延时列表和队列的等待列表中移除，并放入就绪列表。当 <code>Task_A</code> 运行时，<code>xQueueReceive</code> 会返回 <code>errQUEUE_EMPTY</code> 或 <code>pdFALSE</code>，告知调用者超时发生了。</li>
</ul>
</li>
</ul>
<p><strong>内核保证了操作的原子性</strong>，所以一个任务只会因为<strong>一个原因</strong>（要么事件，要么超时）被唤醒，不会出现混乱。</p>
<hr />
<h3 id="_12">总结</h3>
<p>FreeRTOS 的超时唤醒机制可以概括为：</p>
<table>
<thead>
<tr>
<th style="text-align: left;">组件</th>
<th style="text-align: left;">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SysTick 定时器</strong></td>
<td style="text-align: left;">提供系统心跳，驱动时间前进。</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>xTickCount</code></strong></td>
<td style="text-align: left;">系统时间基准。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>延时列表</strong></td>
<td style="text-align: left;">一个按超时时间<strong>排序</strong>的列表，管理所有阻塞中的任务。</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>xNextTaskUnblockTime</code></strong></td>
<td style="text-align: left;"><strong>性能关键</strong>：记录下一个超时点，让调度器在空闲时能进入低功耗模式。</td>
</tr>
<tr>
<td style="text-align: left;"><strong><code>xTaskIncrementTick()</code></strong></td>
<td style="text-align: left;"><strong>核心函数</strong>：在每次心跳中断中被调用，检查并处理超时任务。</td>
</tr>
</tbody>
</table>
<p>这种基于<strong>排序列表</strong>和<strong>全局最小超时时间</strong>的设计，使得超时检查非常高效（O(1) 的快速检查），是 FreeRTOS 适合资源受限但实时性要求高的嵌入式系统的原因之一。</p>
<h1 id="freertos">FreeRTOS</h1>
<h2 id="_13">队列创建函数</h2>
<h3 id="xqueuecreate-">xQueueCreate - 动态创建队列</h3>
<pre><code class="language-c">QueueHandle_t xQueueCreate(UBaseType_t uxQueueLength, 
                          UBaseType_t uxItemSize);
</code></pre>
<p><strong>参数说明</strong>：
- <code>uxQueueLength</code>：队列能够存储的最大项目数量
- <code>uxItemSize</code>：每个项目的大小，以字节为单位</p>
<p><strong>返回值</strong>：
- 成功：返回队列句柄
- 失败：返回NULL（内存不足时）</p>
<p><strong>创建示例</strong>：</p>
<pre><code class="language-c">// 创建存储10个整数的队列
QueueHandle_t xIntQueue = xQueueCreate(10, sizeof(int));

// 创建存储5个浮点数的队列  
QueueHandle_t xFloatQueue = xQueueCreate(5, sizeof(float));

// 创建存储自定义结构体的队列
typedef struct {
    uint8_t command;
    uint32_t parameter;
    TickType_t timestamp;
} Command_t;
QueueHandle_t xCommandQueue = xQueueCreate(8, sizeof(Command_t));
</code></pre>
<h3 id="xqueuecreatestatic-">xQueueCreateStatic - 静态创建队列</h3>
<pre><code class="language-c">QueueHandle_t xQueueCreateStatic(UBaseType_t uxQueueLength,
                                UBaseType_t uxItemSize,
                                uint8_t *pucQueueStorageBuffer,
                                StaticQueue_t *pxQueueBuffer);
</code></pre>
<p><strong>参数说明</strong>：
- <code>pucQueueStorageBuffer</code>：指向队列存储区的指针
- <code>pxQueueBuffer</code>：指向队列控制结构体的指针</p>
<p><strong>静态创建示例</strong>：</p>
<pre><code class="language-c">// 预分配存储区和控制结构
#define QUEUE_LENGTH 5
#define ITEM_SIZE sizeof(int)

static uint8_t ucQueueStorage[QUEUE_LENGTH * ITEM_SIZE];
static StaticQueue_t xQueueBuffer;

// 静态创建队列
QueueHandle_t xStaticQueue = xQueueCreateStatic(QUEUE_LENGTH,
                                               ITEM_SIZE,
                                               ucQueueStorage,
                                               &amp;xQueueBuffer);
</code></pre>
<h2 id="_14">队列复位与删除函数</h2>
<h3 id="vqueuereset-">vQueueReset - 队列复位</h3>
<pre><code class="language-c">void vQueueReset(QueueHandle_t xQueue);
</code></pre>
<p><strong>功能</strong>：将队列重置为空状态，清除所有数据</p>
<p><strong>注意事项</strong>：
- 复位时不会唤醒正在等待队列的任务
- 需要在确保没有任务使用队列时调用
- 谨慎使用，可能造成数据丢失</p>
<h3 id="vqueuedelete-">vQueueDelete - 队列删除</h3>
<pre><code class="language-c">void vQueueDelete(QueueHandle_t xQueue);
</code></pre>
<p><strong>使用场景</strong>：
- 动态创建的队列不再需要时释放内存
- 系统重新配置时清理资源
- 应用程序关闭时清理</p>
<p><strong>删除示例</strong>：</p>
<pre><code class="language-c">void vCleanupResources(void) {
    if(xCommandQueue != NULL) {
        vQueueDelete(xCommandQueue);
        xCommandQueue = NULL;
    }
}
</code></pre>
<h2 id="_15">队列写入函数</h2>
<h3 id="xqueuesend-fifo">xQueueSend - 后端发送（标准FIFO）</h3>
<pre><code class="language-c">BaseType_t xQueueSend(QueueHandle_t xQueue,
                     const void *pvItemToQueue,
                     TickType_t xTicksToWait);
</code></pre>
<p><strong>阻塞行为</strong>：
- <code>xTicksToWait = 0</code>：非阻塞，队列满立即返回
- <code>xTicksToWait = portMAX_DELAY</code>：无限阻塞，直到队列有空位
- <code>xTicksToWait = N</code>：阻塞N个时钟节拍</p>
<p><strong>使用示例</strong>：</p>
<pre><code class="language-c">int data = 42;
// 尝试发送，等待最多100ms
if(xQueueSend(xQueue, &amp;data, 100 / portTICK_PERIOD_MS) != pdPASS) {
    printf(&quot;Send failed: queue full\n&quot;);
}
</code></pre>
<h3 id="xqueuesendtofront-lifo">xQueueSendToFront - 前端发送（LIFO）</h3>
<pre><code class="language-c">BaseType_t xQueueSendToFront(QueueHandle_t xQueue,
                            const void *pvItemToQueue,
                            TickType_t xTicksToWait);
</code></pre>
<p><strong>特点</strong>：数据插入队列前端，实现后进先出行为</p>
<p><strong>应用场景</strong>：
- 紧急消息需要优先处理
- 实现栈数据结构</p>
<h3 id="xqueuesendtoback-">xQueueSendToBack - 后端发送</h3>
<p>与<code>xQueueSend</code>功能完全相同，都是标准FIFO发送。</p>
<h3 id="xqueueoverwrite-">xQueueOverwrite - 覆盖写入</h3>
<pre><code class="language-c">BaseType_t xQueueOverwrite(QueueHandle_t xQueue,
                          const void *pvItemToQueue);
</code></pre>
<p><strong>特点</strong>：
- 专为长度为1的队列设计
- 如果队列已满，自动覆盖最老的数据
- 永远不会阻塞，总是成功</p>
<p><strong>适用场景</strong>：
- 只需要最新数据的传感器采样
- 状态更新，只关心最新状态</p>
<h3 id="_16">中断安全写入函数</h3>
<h4 id="xqueuesendfromisr">xQueueSendFromISR</h4>
<pre><code class="language-c">BaseType_t xQueueSendFromISR(QueueHandle_t xQueue,
                            const void *pvItemToQueue,
                            BaseType_t *pxHigherPriorityTaskWoken);
</code></pre>
<h4 id="xqueuesendtofrontfromisr">xQueueSendToFrontFromISR</h4>
<pre><code class="language-c">BaseType_t xQueueSendToFrontFromISR(QueueHandle_t xQueue,
                                   const void *pvItemToQueue,
                                   BaseType_t *pxHigherPriorityTaskWoken);
</code></pre>
<h4 id="xqueueoverwritefromisr">xQueueOverwriteFromISR</h4>
<pre><code class="language-c">BaseType_t xQueueOverwriteFromISR(QueueHandle_t xQueue,
                                 const void *pvItemToQueue,
                                 BaseType_t *pxHigherPriorityTaskWoken);
</code></pre>
<p><strong>pxHigherPriorityTaskWoken参数</strong>：
- 如果写入操作唤醒了更高优先级的任务，该参数会被设置为pdTRUE
- 在中断退出前需要检查此参数，必要时手动进行上下文切换</p>
<p><strong>中断中使用示例</strong>：</p>
<pre><code class="language-c">void UART_IRQHandler(void) {
    BaseType_t xHigherPriorityTaskWoken = pdFALSE;
    char received_char;

    // 从UART读取字符
    received_char = UART-&gt;DR;

    // 发送到队列
    xQueueSendFromISR(xUartQueue, &amp;received_char, &amp;xHigherPriorityTaskWoken);

    // 必要时进行任务切换
    portYIELD_FROM_ISR(xHigherPriorityTaskWoken);
}
</code></pre>
<h2 id="_17">队列读取函数</h2>
<h3 id="xqueuereceive-">xQueueReceive - 接收并移除数据</h3>
<pre><code class="language-c">BaseType_t xQueueReceive(QueueHandle_t xQueue,
                        void *pvBuffer,
                        TickType_t xTicksToWait);
</code></pre>
<p><strong>功能</strong>：从队列前端读取数据，读取后数据从队列中移除</p>
<p><strong>阻塞行为</strong>：
- <code>xTicksToWait = 0</code>：非阻塞，队列空立即返回
- <code>xTicksToWait = portMAX_DELAY</code>：无限阻塞，直到队列有数据
- <code>xTicksToWait = N</code>：阻塞N个时钟节拍</p>
<p><strong>使用示例</strong>：</p>
<pre><code class="language-c">int received_data;

// 等待数据，最多等待500ms
if(xQueueReceive(xQueue, &amp;received_data, 500 / portTICK_PERIOD_MS) == pdPASS) {
    printf(&quot;Received: %d\n&quot;, received_data);
} else {
    printf(&quot;No data received within timeout\n&quot;);
}
</code></pre>
<h3 id="xqueuepeek-">xQueuePeek - 查看但不移除数据</h3>
<pre><code class="language-c">BaseType_t xQueuePeek(QueueHandle_t xQueue,
                     void *pvBuffer,
                     TickType_t xTicksToWait);
</code></pre>
<p><strong>特点</strong>：
- 读取队列前端数据但不从队列中移除
- 多个任务可以同时查看相同数据
- 数据仍然保留在队列中供其他任务读取</p>
<p><strong>应用场景</strong>：
- 多个任务需要监控相同数据
- 数据广播场景</p>
<h3 id="_18">中断安全读取函数</h3>
<h4 id="xqueuereceivefromisr">xQueueReceiveFromISR</h4>
<pre><code class="language-c">BaseType_t xQueueReceiveFromISR(QueueHandle_t xQueue,
                               void *pvBuffer,
                               BaseType_t *pxHigherPriorityTaskWoken);
</code></pre>
<h4 id="xqueuepeekfromisr">xQueuePeekFromISR</h4>
<pre><code class="language-c">BaseType_t xQueuePeekFromISR(QueueHandle_t xQueue,
                            void *pvBuffer);
</code></pre>
<p><strong>注意</strong>：<code>xQueuePeekFromISR</code>没有超时参数，因为中断中不应该阻塞。</p>
<h2 id="_19">队列查询函数</h2>
<h3 id="uxqueuemessageswaiting-">uxQueueMessagesWaiting - 查询消息数量</h3>
<pre><code class="language-c">UBaseType_t uxQueueMessagesWaiting(QueueHandle_t xQueue);
</code></pre>
<p><strong>返回值</strong>：队列中当前存储的消息数量</p>
<h3 id="uxqueuespacesavailable-">uxQueueSpacesAvailable - 查询剩余空间</h3>
<pre><code class="language-c">UBaseType_t uxQueueSpacesAvailable(QueueHandle_t xQueue);
</code></pre>
<p><strong>返回值</strong>：队列中剩余可用的空间数量</p>
<h3 id="_20">中断安全查询函数</h3>
<h4 id="uxqueuemessageswaitingfromisr">uxQueueMessagesWaitingFromISR</h4>
<pre><code class="language-c">UBaseType_t uxQueueMessagesWaitingFromISR(QueueHandle_t xQueue);
</code></pre>
<h3 id="_21">查询函数使用示例</h3>
<pre><code class="language-c">void vQueueStatusMonitor(QueueHandle_t xQueue) {
    UBaseType_t uxMessages = uxQueueMessagesWaiting(xQueue);
    UBaseType_t uxSpaces = uxQueueSpacesAvailable(xQueue);
    UBaseType_t uxTotalLength = uxMessages + uxSpaces;

    printf(&quot;Queue Status: %d/%d messages (%.1f%% full)\n&quot;,
           uxMessages, uxTotalLength,
           (float)uxMessages / uxTotalLength * 100);

    // 根据队列状态调整行为
    if(uxSpaces == 0) {
        printf(&quot;Warning: Queue is full!\n&quot;);
    } else if(uxMessages == 0) {
        printf(&quot;Info: Queue is empty\n&quot;);
    }
}
</code></pre>
<h1 id="cmsisv2-api">CMSISv2 API</h1>
<h2 id="osmessagequeuenew-">osMessageQueueNew - 创建消息队列</h2>
<pre><code class="language-c">osMessageQueueId_t osMessageQueueNew(uint32_t msg_count, 
                                    uint32_t msg_size, 
                                    const osMessageQueueAttr_t *attr);
</code></pre>
<p><strong>参数说明</strong>:</p>
<ul>
<li><code>msg_count</code>: 队列容量（消息数量）</li>
<li><code>msg_size</code>: 每个消息的大小（字节）</li>
<li><code>attr</code>: 队列属性（名称、内存区域等）</li>
</ul>
<p><strong>创建示例</strong>:</p>
<pre><code class="language-c">// 静态分配方式
static uint8_t queue_mem[10 * sizeof(my_data_t)];
static osMessageQueueId_t my_queue;

void create_queue_static(void) {
    osMessageQueueAttr_t attr = {
        .name = &quot;StaticQueue&quot;,
        .cb_mem = &amp;queue_mem,
        .cb_size = sizeof(queue_mem)
    };
    my_queue = osMessageQueueNew(10, sizeof(my_data_t), &amp;attr);
}

// 动态分配方式
void create_queue_dynamic(void) {
    osMessageQueueAttr_t attr = {
        .name = &quot;DynamicQueue&quot;
    };
    my_queue = osMessageQueueNew(10, sizeof(my_data_t), &amp;attr);
}
</code></pre>
<h2 id="osmessagequeueput-">osMessageQueuePut - 发送消息</h2>
<pre><code class="language-c">osStatus_t osMessageQueuePut(osMessageQueueId_t mq_id,
                            const void *msg_ptr,
                            uint8_t msg_prio,
                            uint32_t timeout);
</code></pre>
<p><strong>参数说明</strong>:</p>
<ul>
<li><code>mq_id</code>: 消息队列ID</li>
<li><code>msg_ptr</code>: 指向要发送的消息</li>
<li><code>msg_prio</code>: 消息优先级（通常为0）</li>
<li><code>timeout</code>: 超时时间（osWaitForever, 0, 或具体毫秒数）</li>
</ul>
<p><strong>使用示例</strong>:</p>
<pre><code class="language-c">typedef struct {
    int sensor_id;
    float value;
    uint32_t timestamp;
} sensor_data_t;

void send_sensor_data(void) {
    sensor_data_t data = {1, 25.5f, osKernelGetTickCount()};

    osStatus_t status = osMessageQueuePut(sensor_queue, &amp;data, 0, osWaitForever);
    if(status == osOK) {
        printf(&quot;Data sent successfully\n&quot;);
    } else {
        printf(&quot;Failed to send data: %d\n&quot;, status);
    }
}
</code></pre>
<h2 id="osmessagequeueget-">osMessageQueueGet - 接收消息</h2>
<pre><code class="language-c">osStatus_t osMessageQueueGet(osMessageQueueId_t mq_id,
                            void *msg_ptr,
                            uint8_t *msg_prio,
                            uint32_t timeout);
</code></pre>
<p><strong>使用示例</strong>:</p>
<pre><code class="language-c">void receive_sensor_data(void) {
    sensor_data_t received_data;
    uint8_t priority;

    osStatus_t status = osMessageQueueGet(sensor_queue, &amp;received_data, &amp;priority, 1000);
    if(status == osOK) {
        printf(&quot;Received: Sensor%d=%.1f at %lu\n&quot;, 
               received_data.sensor_id, received_data.value, received_data.timestamp);
    } else if(status == osErrorTimeout) {
        printf(&quot;No data received within timeout\n&quot;);
    } else {
        printf(&quot;Error receiving data: %d\n&quot;, status);
    }
}
</code></pre>
<h2 id="_22">其他队列管理函数</h2>
<h3 id="osmessagequeuegetcount">osMessageQueueGetCount</h3>
<pre><code class="language-c">uint32_t osMessageQueueGetCount(osMessageQueueId_t mq_id);
</code></pre>
<h3 id="osmessagequeuegetspace">osMessageQueueGetSpace</h3>
<pre><code class="language-c">uint32_t osMessageQueueGetSpace(osMessageQueueId_t mq_id);
</code></pre>
<h3 id="osmessagequeuedelete">osMessageQueueDelete</h3>
<pre><code class="language-c">osStatus_t osMessageQueueDelete(osMessageQueueId_t mq_id);
</code></pre>
<h3 id="osmessagequeuereset">osMessageQueueReset</h3>
<pre><code class="language-c">osStatus_t osMessageQueueReset(osMessageQueueId_t mq_id);
</code></pre>
<table>
<thead>
<tr>
<th style="text-align: left;">操作</th>
<th style="text-align: left;">FreeRTOS</th>
<th style="text-align: left;">CMSIS-RTOS v2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">创建队列</td>
<td style="text-align: left;"><code>xQueueCreate()</code></td>
<td style="text-align: left;"><code>osMessageQueueNew()</code></td>
</tr>
<tr>
<td style="text-align: left;">发送队列</td>
<td style="text-align: left;"><code>xQueueSend()</code></td>
<td style="text-align: left;"><code>osMessageQueuePut()</code></td>
</tr>
<tr>
<td style="text-align: left;">接收队列</td>
<td style="text-align: left;"><code>xQueueReceive()</code></td>
<td style="text-align: left;"><code>osMessageQueueGet()</code></td>
</tr>
<tr>
<td style="text-align: left;">查询消息数</td>
<td style="text-align: left;"><code>uxQueueMessagesWaiting()</code></td>
<td style="text-align: left;"><code>osMessageQueueGetCount()</code></td>
</tr>
<tr>
<td style="text-align: left;">查询空间</td>
<td style="text-align: left;"><code>uxQueueSpacesAvailable()</code></td>
<td style="text-align: left;"><code>osMessageQueueGetSpace()</code></td>
</tr>
<tr>
<td style="text-align: left;">删除队列</td>
<td style="text-align: left;"><code>vQueueDelete()</code></td>
<td style="text-align: left;"><code>osMessageQueueDelete()</code></td>
</tr>
<tr>
<td style="text-align: left;">重置队列</td>
<td style="text-align: left;"><code>vQueueReset()</code></td>
<td style="text-align: left;"><code>osMessageQueueReset()</code></td>
</tr>
</tbody>
</table>
<h1 id="_23">队列使用最佳实践总结</h1>
<h2 id="_24">队列设计原则</h2>
<p><strong>合理设置队列长度</strong>：
- 根据数据产生速度和消费速度计算
- 考虑最坏情况下的数据积压
- 平衡内存使用和系统可靠性</p>
<p><strong>选择适当的数据类型</strong>：
- 简单数据直接传递值
- 复杂数据使用结构体封装
- 大数据量考虑传递指针（需自行管理内存）</p>
<h2 id="_25">错误处理策略</h2>
<p><strong>发送失败处理</strong>：</p>
<pre><code class="language-c">BaseType_t xResult = xQueueSend(xQueue, &amp;data, timeout);
if(xResult != pdPASS) {
    // 处理策略：重试、丢弃、转存等
    handle_send_failure(data);
}
</code></pre>
<p><strong>接收超时处理</strong>：</p>
<pre><code class="language-c">if(xQueueReceive(xQueue, &amp;data, timeout) != pdPASS) {
    // 处理策略：使用默认值、尝试恢复等
    handle_receive_timeout();
}
</code></pre>
<h2 id="_26">性能优化建议</h2>
<ol>
<li><strong>减少数据拷贝</strong>：对于大型数据，考虑传递指针</li>
<li><strong>合理使用覆盖写入</strong>：对于只需要最新数据的场景</li>
<li><strong>优化队列长度</strong>：避免过长队列增加搜索时间</li>
<li><strong>使用静态分配</strong>：在内存受限系统中减少动态分配开销</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Your Name
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.expand", "navigation.indexes", "search.suggest", "search.highlight"], "search": "../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>