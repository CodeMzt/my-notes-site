
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="机器学习与嵌入式开发笔记">
      
      
      
      
        <link rel="prev" href="../%E4%BB%BB%E5%8A%A1%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4/">
      
      
        <link rel="next" href="../%E4%BB%BB%E5%8A%A1%E9%80%9A%E7%9F%A5/">
      
      
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>任务调度 - 个人技术与学习笔记</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="个人技术与学习笔记" class="md-header__button md-logo" aria-label="个人技术与学习笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            个人技术与学习笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              任务调度
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="个人技术与学习笔记" class="md-nav__button md-logo" aria-label="个人技术与学习笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    个人技术与学习笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    机器学习 (Machine Learning)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    机器学习 (Machine Learning)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Pytorch 学习
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Pytorch 学习
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/nn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    nn 神经网络
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/tensor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tensor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    data 数据处理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/transfrom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    transform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/tensorboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    tensorboard 可视化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/Test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Notebook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    电赛软件 (Embedded Software)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    电赛软件 (Embedded Software)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E8%B5%9B%E8%BD%AF%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ARM 架构
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    ARM 架构
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARM%E6%9E%B6%E6%9E%84/ARM%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ARM 架构概述
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARM%E6%9E%B6%E6%9E%84/ARM%20Cortex-M%20CPU%20%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ARM Cortex-M CPU 架构
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARM%E6%9E%B6%E6%9E%84/%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    通用寄存器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARM%E6%9E%B6%E6%9E%84/%E7%89%B9%E6%AE%8A%E5%AF%84%E5%AD%98%E5%99%A8xPSR/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    特殊寄存器xPSR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    RTOS 实时操作系统
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    RTOS 实时操作系统
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../RTOS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务堆栈
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务切换
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    FreeRTOS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    FreeRTOS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FreeRTOS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FreeRTOS 简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%BB%BB%E5%8A%A1%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务创建和删除
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    任务调度
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    任务调度
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cmsis" class="md-nav__link">
    <span class="md-ellipsis">
      
        CMSIS级别操作
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CMSIS级别操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#svc_setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        SVC_Setup()
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SVC_Setup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        详细解释：
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="详细解释：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-svc" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. SVC 异常的作用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-svc" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 为什么要设置 SVC 优先级
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-svc_setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. SVC_Setup() 的具体工作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-oskernelstart" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. 在 osKernelStart() 中的意义
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freertos" class="md-nav__link">
    <span class="md-ellipsis">
      
        FreeRTOS级别操作
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FreeRTOS级别操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vtaskstartscheduler" class="md-nav__link">
    <span class="md-ellipsis">
      
        vTaskStartScheduler()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xportstartscheduler" class="md-nav__link">
    <span class="md-ellipsis">
      
        xPortStartScheduler()
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="xPortStartScheduler()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        函数概述
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        代码分析
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="代码分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 异常优先级配置
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 系统定时器初始化
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 调度器状态初始化
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. 启动第一个任务
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        启动第一个任务的核心机制
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="启动第一个任务的核心机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 堆栈指针初始化
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 中断使能
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-svc" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 触发 SVC 异常启动任务
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#svc" class="md-nav__link">
    <span class="md-ellipsis">
      
        SVC 异常处理程序的关键操作
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SVC 异常处理程序的关键操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 任务上下文恢复
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 切换到任务模式
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计原理分析
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="设计原理分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-svc_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 为什么使用 SVC 异常启动任务？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 优先级配置的重要性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 状态机转换
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        错误处理机制
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="错误处理机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        启动失败的可能原因
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        返回值语义
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%BB%BB%E5%8A%A1%E9%80%9A%E7%9F%A5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    任务通知
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    内存管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E4%B8%8E%E9%80%9A%E4%BF%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    同步、互斥与通信
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E9%98%9F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    队列
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E9%98%9F%E5%88%97%E9%9B%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    队列集
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%B8%AD%E6%96%AD%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    中断管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%A7%BB%E6%A4%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    移植
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    STM32 HAL 库
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    STM32 HAL 库
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/STM32%20HAL%E5%BA%93/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    库介绍
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/GPIO%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPIO 操作
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/NVIC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NVIC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/DMA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DMA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/ADC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/%E5%AE%9A%E6%97%B6%E5%99%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    定时器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/FLASH/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FLASH
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/BKP%26RTC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BKP & RTC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/WDG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WDG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../STM32%20HAL%E5%BA%93/%E7%A1%AC%E4%BB%B6%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    硬件通信协议
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    通信协议
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    通信协议
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/I2C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    I2C
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/SPI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SPI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/USART/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    USART
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/CAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CAN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    电控算法
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    电控算法
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/PID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/LQR/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LQR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/SMC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SMC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    视觉应用
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    视觉应用
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%A7%86%E8%A7%89/%E8%A7%86%E8%A7%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    视觉
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E8%A7%86%E8%A7%89/Micropython%20%26%20K230/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Micropython & K230
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cmsis" class="md-nav__link">
    <span class="md-ellipsis">
      
        CMSIS级别操作
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CMSIS级别操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#svc_setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        SVC_Setup()
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SVC_Setup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        详细解释：
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="详细解释：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-svc" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. SVC 异常的作用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-svc" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 为什么要设置 SVC 优先级
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-svc_setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. SVC_Setup() 的具体工作
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-oskernelstart" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. 在 osKernelStart() 中的意义
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freertos" class="md-nav__link">
    <span class="md-ellipsis">
      
        FreeRTOS级别操作
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FreeRTOS级别操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vtaskstartscheduler" class="md-nav__link">
    <span class="md-ellipsis">
      
        vTaskStartScheduler()
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xportstartscheduler" class="md-nav__link">
    <span class="md-ellipsis">
      
        xPortStartScheduler()
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="xPortStartScheduler()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        函数概述
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        代码分析
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="代码分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 异常优先级配置
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 系统定时器初始化
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 调度器状态初始化
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. 启动第一个任务
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        启动第一个任务的核心机制
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="启动第一个任务的核心机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 堆栈指针初始化
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 中断使能
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-svc" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 触发 SVC 异常启动任务
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#svc" class="md-nav__link">
    <span class="md-ellipsis">
      
        SVC 异常处理程序的关键操作
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SVC 异常处理程序的关键操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 任务上下文恢复
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 切换到任务模式
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        设计原理分析
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="设计原理分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-svc_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 为什么使用 SVC 异常启动任务？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 优先级配置的重要性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 状态机转换
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        错误处理机制
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="错误处理机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        启动失败的可能原因
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        返回值语义
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<div class="toc">
<ul>
<li><a href="#_1">启动任务调度器</a><ul>
<li><a href="#cmsis">CMSIS级别操作</a><ul>
<li><a href="#svc_setup">SVC_Setup()</a><ul>
<li><a href="#_2">详细解释：</a><ul>
<li><a href="#1-svc">1. SVC 异常的作用</a></li>
<li><a href="#2-svc">2. 为什么要设置 SVC 优先级</a></li>
<li><a href="#3-svc_setup">3. SVC_Setup() 的具体工作</a></li>
<li><a href="#4-oskernelstart">4. 在 osKernelStart() 中的意义</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#freertos">FreeRTOS级别操作</a><ul>
<li><a href="#vtaskstartscheduler">vTaskStartScheduler()</a></li>
<li><a href="#xportstartscheduler">xPortStartScheduler()</a><ul>
<li><a href="#_3">函数概述</a></li>
<li><a href="#_4">代码分析</a><ul>
<li><a href="#1">1. 异常优先级配置</a></li>
<li><a href="#2">2. 系统定时器初始化</a></li>
<li><a href="#3">3. 调度器状态初始化</a></li>
<li><a href="#4">4. 启动第一个任务</a></li>
</ul>
</li>
<li><a href="#_5">启动第一个任务的核心机制</a><ul>
<li><a href="#1_1">1. 堆栈指针初始化</a></li>
<li><a href="#2_1">2. 中断使能</a></li>
<li><a href="#3-svc">3. 触发 SVC 异常启动任务</a></li>
</ul>
</li>
<li><a href="#svc">SVC 异常处理程序的关键操作</a><ul>
<li><a href="#1_2">1. 任务上下文恢复</a></li>
<li><a href="#2_2">2. 切换到任务模式</a></li>
</ul>
</li>
<li><a href="#_6">设计原理分析</a><ul>
<li><a href="#1-svc_1">1. 为什么使用 SVC 异常启动任务？</a></li>
<li><a href="#2_3">2. 优先级配置的重要性</a></li>
<li><a href="#3_1">3. 状态机转换</a></li>
</ul>
</li>
<li><a href="#_7">错误处理机制</a><ul>
<li><a href="#_8">启动失败的可能原因</a></li>
<li><a href="#_9">返回值语义</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_10">任务切换</a><ul>
<li><a href="#_11">基本概念</a></li>
<li><a href="#_12">类比理解</a></li>
<li><a href="#_13">上下文切换的深入理解</a><ul>
<li><a href="#_14">什么是上下文</a></li>
<li><a href="#_15">上下文切换的过程</a></li>
</ul>
</li>
<li><a href="#freertos_1">FreeRTOS 任务切换的触发条件</a><ul>
<li><a href="#_16">主动触发方式</a></li>
<li><a href="#_17">被动触发方式</a></li>
</ul>
</li>
<li><a href="#freertos_2">FreeRTOS 任务切换的硬件机制</a><ul>
<li><a href="#arm-cortex-m">ARM Cortex-M 异常系统</a></li>
<li><a href="#_18">优先级配置策略</a></li>
</ul>
</li>
<li><a href="#_19">任务切换的详细执行流程</a><ul>
<li><a href="#_20">完整的切换序列</a></li>
</ul>
</li>
<li><a href="#tcb">任务控制块（TCB）的关键作用</a><ul>
<li><a href="#tcb_1">TCB 数据结构</a></li>
<li><a href="#_21">堆栈布局设计</a></li>
</ul>
</li>
<li><a href="#_22">时间片轮转调度原理</a><ul>
<li><a href="#_23">同优先级任务调度</a></li>
</ul>
</li>
<li><a href="#_24">性能优化技术</a><ul>
<li><a href="#_25">快速任务选择算法</a></li>
<li><a href="#_26">中断延迟优化</a></li>
</ul>
</li>
<li><a href="#_27">实际应用场景分析</a><ul>
<li><a href="#_28">场景一：高优先级任务抢占</a></li>
<li><a href="#_29">场景二：资源共享与同步</a></li>
</ul>
</li>
<li><a href="#_30">调试与性能分析</a><ul>
<li><a href="#_31">上下文切换开销测量</a></li>
<li><a href="#_32">常见问题与解决方案</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#api">其他API函数</a><ul>
<li><a href="#freertos_3">FreeRTOS</a></li>
<li><a href="#cmsis-rtos-v2">CMSIS-RTOS v2</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_1">启动任务调度器</h1>
<h2 id="cmsis">CMSIS级别操作</h2>
<pre><code class="language-c">osStatus_t osKernelStart (void) {
  osStatus_t stat;

  if (IS_IRQ()) {
    stat = osErrorISR;
  }
  else {
    if (KernelState == osKernelReady) {
      /* Ensure SVC priority is at the reset value */
      SVC_Setup();
      /* Change state to enable IRQ masking check */
      KernelState = osKernelRunning;
      /* Start the kernel scheduler */
      vTaskStartScheduler();
      stat = osOK;
    } else {
      stat = osError;
    }
  }

  return (stat);
}
</code></pre>
<h3 id="svc_setup"><code>SVC_Setup()</code></h3>
<p>这一句 <code>SVC_Setup();</code> 在 CMSIS-RTOS2 的 <code>osKernelStart()</code> 函数中，主要目的是<strong>确保 SVC（Supervisor Call）异常的优先级被设置为复位后的默认值</strong>。
关于<strong>异常</strong>可看<a href="中断管理">中断管理</a></p>
<h4 id="_2">详细解释：</h4>
<h5 id="1-svc">1. SVC 异常的作用</h5>
<ul>
<li>SVC 是 ARM Cortex-M 处理器的一个系统异常</li>
<li>RTOS 使用 SVC 异常来实现从用户模式（线程模式）到特权模式（处理器模式）的安全切换</li>
<li>系统调用（如创建线程、信号量操作等）通常通过 SVC 指令触发</li>
</ul>
<h5 id="2-svc">2. 为什么要设置 SVC 优先级</h5>
<ul>
<li>在系统启动过程中，某些初始化代码或第三方库可能会修改 SVC 的优先级</li>
<li>如果 SVC 优先级设置不当，可能导致：</li>
<li>系统调用无法正确执行</li>
<li>任务调度出现问题</li>
<li>系统稳定性降低</li>
</ul>
<h5 id="3-svc_setup">3. <code>SVC_Setup()</code> 的具体工作</h5>
<pre><code class="language-c">static void SVC_Setup (void) {
  #if   (defined(__ARM_ARCH_7M__) &amp;&amp; (__ARM_ARCH_7M__ != 0)) || \
        (defined(__ARM_ARCH_7EM__) &amp;&amp; (__ARM_ARCH_7EM__ != 0))
  SCB-&gt;SHCSR |= SCB_SHCSR_SVCALLUSED_Msk;  // 启用 SVC 异常
  NVIC_SetPriority(SVCall_IRQn, 0xFE);     // 设置较低的优先级
  #endif
}
</code></pre>
<h5 id="4-oskernelstart">4. 在 <code>osKernelStart()</code> 中的意义</h5>
<ul>
<li>确保内核启动前 SVC 异常处于已知的、正确的状态</li>
<li>为后续的系统调用和任务调度提供可靠的基础</li>
<li>这是 RTOS 启动过程中的重要安全措施</li>
</ul>
<h2 id="freertos">FreeRTOS级别操作</h2>
<h3 id="vtaskstartscheduler"><code>vTaskStartScheduler()</code></h3>
<pre><code class="language-c">void vTaskStartScheduler( void )
{
    /* Add the idle task at the lowest priority. */
    //1.创建空闲任务
    xTaskCreate() or xTaskCreateStatic()

    //2.创建软件定时器任务（如果使能）
    xTimerCreateTimerTask()

    //3.关中断，防止调度器开启之前或之中受中断干扰
    portDISABLE_INTERRUPTS();

    xNextTaskUnblockTime = portMAX_DELAY; //设置第一个任务的阻塞超时时间为很大0xffffffffUL
    xSchedulerRunning = pdTRUE; //标记任务调度器开始运行
    xTickCount = ( TickType_t ) configINITIAL_TICK_COUNT; //初始化心跳计数器为0

    portCONFIGURE_TIMER_FOR_RUN_TIME_STATS();//统计任务运行时间的实现接口（用户实现）

    traceTASK_SWITCHED_IN()//调试接口，需要实现
</code></pre>
<h3 id="xportstartscheduler"><code>xPortStartScheduler()</code></h3>
<p><code>xPortStartScheduler()</code> 是 FreeRTOS 调度器的核心启动函数，负责初始化硬件资源并启动多任务调度环境。</p>
<h4 id="_3">函数概述</h4>
<p><code>xPortStartScheduler()</code> 位于 FreeRTOS 的移植层（通常是 <code>port.c</code> 文件），主要职责包括：</p>
<ul>
<li>配置系统关键硬件（如 SysTick 定时器）</li>
<li>设置异常优先级</li>
<li>启动第一个任务</li>
<li>永不返回（除非发生严重错误）</li>
</ul>
<h4 id="_4">代码分析</h4>
<h5 id="1">1. 异常优先级配置</h5>
<pre><code class="language-c">BaseType_t xPortStartScheduler( void )
{
    /* 配置 PendSV 和 SysTick 异常的优先级 */
    portNVIC_SYSPRI2_REG |= portNVIC_PENDSV_PRI;
    portNVIC_SYSPRI2_REG |= portNVIC_SYSTICK_PRI;
</code></pre>
<p><strong>关键设计要点</strong>：</p>
<ul>
<li>PendSV 优先级设置为最低，确保高优先级中断能够立即响应</li>
<li>这种设计避免了任务切换阻塞时间敏感的中断处理</li>
</ul>
<h5 id="2">2. 系统定时器初始化</h5>
<pre><code class="language-c">    /* 启动 SysTick 定时器 - 提供任务调度的时间基准 */
    vPortSetupTimerInterrupt();
</code></pre>
<p>SysTick 定时器的作用：
- 产生固定的时间节拍（tick）
- 驱动时间片轮转调度
- 管理阻塞任务的超时机制</p>
<h5 id="3">3. 调度器状态初始化</h5>
<pre><code class="language-c">    /* 初始化调度器关键变量 */
    xNextTaskUnblockTime = portMAX_DELAY;
    xSchedulerRunning = pdTRUE;
    xTickCount = 0;
</code></pre>
<h5 id="4">4. 启动第一个任务</h5>
<pre><code class="language-c">    /* 启动第一个任务 */
    if( xPortStartFirstTask() != pdFALSE )
    {
        /* 如果执行到这里，说明任务启动失败 */
        return pdFALSE;
    }

    /* 正常情况下不会到达这里 */
    return pdFALSE;
}
</code></pre>
<h4 id="_5">启动第一个任务的核心机制</h4>
<p><code>xPortStartFirstTask()</code> 通常用汇编语言实现，主要步骤包括：</p>
<h5 id="1_1">1. 堆栈指针初始化</h5>
<pre><code class="language-assembly">xPortStartFirstTask:
    /* 从向量表初始化主堆栈指针 */
    ldr r0, =0xE000ED08    /* VTOR 寄存器地址 */
    ldr r0, [r0]
    ldr r0, [r0]           /* 获取初始 MSP 值 */
    msr msp, r0            /* 设置主堆栈指针 */
</code></pre>
<h5 id="2_1">2. 中断使能</h5>
<pre><code class="language-assembly">    /* 使能全局中断 */
    cpsie i                /* 使能 IRQ 中断 */
    cpsie f                /* 使能 Fault 中断 */
    dsb
    isb
</code></pre>
<h5 id="3-svc">3. 触发 SVC 异常启动任务</h5>
<pre><code class="language-assembly">    /* 通过 SVC 异常启动第一个任务 */
    svc 0                  /* 触发 SVC 异常 */

    /* SVC 异常处理程序会配置任务环境并开始执行 */
</code></pre>
<h4 id="svc">SVC 异常处理程序的关键操作</h4>
<p>在 SVC 异常处理程序中完成以下关键操作：</p>
<h5 id="1_2">1. 任务上下文恢复</h5>
<pre><code class="language-c">void vPortSVCHandler( void )
{
    /* 从当前任务的 TCB 中恢复堆栈指针 */
    pxCurrentTCB = 获取最高优先级任务的 TCB;
    __asm volatile (
        &quot;ldr r3, [%0]          \n&quot; /* 从 TCB 获取堆栈指针 */
        &quot;ldmdb r3!, {r0-r2}    \n&quot; /* 恢复部分寄存器 */
        &quot;msr control, r0       \n&quot; /* 设置控制寄存器 */
        &quot;msr psp, r3           \n&quot; /* 设置进程堆栈指针 */
        &quot;isb                   \n&quot;
        :: &quot;r&quot; (&amp;pxCurrentTCB)
    );
}
</code></pre>
<h5 id="2_2">2. 切换到任务模式</h5>
<pre><code class="language-c">    /* 使用进程堆栈执行任务 */
    __asm volatile (
        &quot;mov r0, #2            \n&quot; /* 切换到线程模式并使用 PSP */
        &quot;msr control, r0       \n&quot;
        &quot;isb                   \n&quot;
        &quot;bx lr                 \n&quot; /* 返回到任务代码 */
    );
</code></pre>
<h4 id="_6">设计原理分析</h4>
<h5 id="1-svc_1">1. 为什么使用 SVC 异常启动任务？</h5>
<ul>
<li><strong>权限切换</strong>：从 Handler 模式（特权级）切换到 Thread 模式（可能为非特权级）</li>
<li><strong>环境隔离</strong>：确保任务在受控的环境中开始执行</li>
<li><strong>堆栈分离</strong>：实现主堆栈（MSP）和进程堆栈（PSP）的分离</li>
</ul>
<h5 id="2_3">2. 优先级配置的重要性</h5>
<ul>
<li><strong>SysTick</strong>：需要适当的优先级来保证时间基准的准确性</li>
<li><strong>PendSV</strong>：最低优先级确保不会延迟高优先级中断的处理</li>
<li><strong>SVC</strong>：用于系统调用，需要合理的优先级设置</li>
</ul>
<h5 id="3_1">3. 状态机转换</h5>
<p>调度器启动过程的状态转换：
1. <strong>初始化状态</strong>：配置硬件，设置优先级
2. <strong>准备状态</strong>：初始化变量，启动定时器
3. <strong>启动状态</strong>：通过 SVC 异常切换到第一个任务
4. <strong>运行状态</strong>：多任务环境正式运行</p>
<h4 id="_7">错误处理机制</h4>
<h5 id="_8">启动失败的可能原因</h5>
<ul>
<li>堆栈指针初始化失败</li>
<li>向量表配置错误</li>
<li>优先级配置冲突</li>
<li>内存分配问题</li>
</ul>
<h5 id="_9">返回值语义</h5>
<ul>
<li><strong>pdTRUE</strong>：启动成功（实际上不会返回）</li>
<li><strong>pdFALSE</strong>：启动失败，需要错误处理</li>
</ul>
<h1 id="_10">任务切换</h1>
<p>任务切换的<strong>本质</strong>：<strong>CPU寄存器的切换</strong></p>
<h3 id="_11">基本概念</h3>
<p>任务切换是多任务操作系统的核心机制，指 CPU 从一个正在运行的任务转移到另一个任务的过程。在单核处理器系统中，多个任务通过快速切换创造"同时运行"的假象。</p>
<h3 id="_12">类比理解</h3>
<p>想象一名厨师同时处理多道菜品：
- 每道菜就是一个任务
- 厨师在不同菜品间快速切换注意力
- 每次切换时需要记住当前菜品的进度
- 切换到另一道菜时需要回忆该菜品的上次状态</p>
<h2 id="_13">上下文切换的深入理解</h2>
<h3 id="_14">什么是上下文</h3>
<p>上下文是指任务在某个时间点的完整执行状态，包括：</p>
<p><strong>硬件上下文：</strong>
- 所有寄存器值（R0-R15）
- 程序状态寄存器（xPSR）
- 堆栈指针（SP）
- 程序计数器（PC）</p>
<p><strong>软件上下文：</strong>
- 任务控制块（TCB）中的状态信息
- 堆栈中的局部变量和返回地址
- 任务特有的配置和数据</p>
<h3 id="_15">上下文切换的过程</h3>
<pre><code class="language-c">// 伪代码表示上下文切换流程
void context_switch(Task* current, Task* next) {
    // 1. 保存当前任务上下文
    save_registers(current-&gt;stack_pointer);
    save_processor_state(current-&gt;tcb);

    // 2. 更新调度器状态
    scheduler-&gt;current_task = next;

    // 3. 恢复新任务上下文  
    restore_processor_state(next-&gt;tcb);
    restore_registers(next-&gt;stack_pointer);

    // 4. 跳转到新任务
    jump_to_task(next-&gt;program_counter);
}
</code></pre>
<h2 id="freertos_1">FreeRTOS 任务切换的触发条件</h2>
<h3 id="_16">主动触发方式</h3>
<p><strong>任务主动让出 CPU <code>portYIELD()/taskYIELD()</code>：</strong></p>
<p>通过挂起PendSV启用PendSv异常，如何挂起见<a href="任务调度器的挂起和恢复">任务调度器的挂起和恢复</a></p>
<pre><code class="language-c">void vTaskA( void *pvParameters )
{
    for( ;; )
    {
        // 执行一些工作
        perform_work();

        // 主动让出 CPU 给其他任务
        taskYIELD();
    }
}
</code></pre>
<p><strong>等待资源时自动切换：</strong></p>
<pre><code class="language-c">void vTaskB( void *pvParameters )
{
    for( ;; )
    {
        // 等待信号量，期间会自动切换任务
        xSemaphoreTake( xBinarySemaphore, portMAX_DELAY );

        // 获取信号量后继续执行
        process_data();
    }
}
</code></pre>
<h3 id="_17">被动触发方式</h3>
<p><strong>时间片到期：</strong></p>
<pre><code class="language-c">// 在 SysTick 中断服务程序中
void xPortSysTickHandler( void )
{
    // 更新时间计数
    if( xTaskIncrementTick() != pdFALSE )
    {
        // 触发任务切换
        portNVIC_INT_CTRL_REG = portNVIC_PENDSVSET_BIT;
    }
}
</code></pre>
<p><strong>中断服务程序中唤醒高优先级任务：</strong></p>
<pre><code class="language-c">void vAnInterruptHandler( void )
{
    BaseType_t xHigherPriorityTaskWoken = pdFALSE;

    // 释放信号量，可能唤醒高优先级任务
    xSemaphoreGiveFromISR( xSemaphore, &amp;xHigherPriorityTaskWoken );

    // 如果需要立即切换
    portYIELD_FROM_ISR( xHigherPriorityTaskWoken );
}
</code></pre>
<h2 id="freertos_2">FreeRTOS 任务切换的硬件机制</h2>
<h3 id="arm-cortex-m">ARM Cortex-M 异常系统</h3>
<p>FreeRTOS 充分利用 ARM Cortex-M 的异常机制来实现高效任务切换：</p>
<p><strong>SysTick 异常：</strong>
- 用途：系统时钟节拍，提供时间基准
- 优先级：配置为较低优先级
- 功能：驱动时间片轮转和任务超时管理</p>
<p><strong>PendSV 异常：</strong></p>
<ul>
<li>用途：可挂起的系统服务，执行实际上下文切换</li>
<li>优先级：配置为最低优先级</li>
<li>特点：可延迟执行，不阻塞高优先级中断</li>
</ul>
<p><strong>SVC 异常：</strong>
- 用途：<strong>系统</strong>调用接口
- 功能：启动调度器和执行<strong>特权</strong>操作</p>
<h3 id="_18">优先级配置策略</h3>
<pre><code class="language-c">// FreeRTOSConfig.h 中的典型配置
#define configKERNEL_INTERRUPT_PRIORITY    255
#define configMAX_SYSCALL_INTERRUPT_PRIORITY  191

// 实际优先级设置
#define portNVIC_PENDSV_PRI          ( ( ( uint32_t ) configKERNEL_INTERRUPT_PRIORITY ) &lt;&lt; 16UL )
#define portNVIC_SYSTICK_PRI         ( ( ( uint32_t ) configKERNEL_INTERRUPT_PRIORITY ) &lt;&lt; 24UL )
</code></pre>
<h2 id="_19">任务切换的详细执行流程</h2>
<h3 id="_20">完整的切换序列</h3>
<p><strong>阶段一：触发切换</strong></p>
<pre><code class="language-c">// 从任务中触发切换
taskYIELD();
    ↓
// 设置 PendSV 挂起位
portNVIC_INT_CTRL_REG = portNVIC_PENDSVSET_BIT;
    ↓
// CPU 在适当时候进入 PendSV 异常
</code></pre>
<p><strong>阶段二：保存当前任务上下文</strong></p>
<pre><code class="language-assembly">vPortPendSVHandler:
    /* 保存当前任务状态 */
    mrs r0, psp                 // 获取当前任务的堆栈指针
    isb                         // 指令同步屏障

    // 将寄存器 r4-r11 保存到任务堆栈（手动压栈）
    stmdb r0!, {r4-r11}

    // 更新任务控制块中的堆栈指针
    ldr r2, =pxCurrentTCB
    ldr r1, [r2]
    str r0, [r1]
</code></pre>
<p><strong>阶段三：选择下一个任务</strong></p>
<pre><code class="language-c">// 调用调度器选择新任务
vTaskSwitchContext();
    ↓
// 调度器决策过程
void vTaskSwitchContext( void )
{
    // 检查调度器是否挂起
    if( uxSchedulerSuspended != ( UBaseType_t ) pdFALSE )
    {
        xYieldPending = pdTRUE;
        return;
    }

    // 寻找最高优先级的就绪任务
    #if ( configUSE_PORT_OPTIMISED_TASK_SELECTION == 1 )
        // 使用位图算法快速查找
        uxTopReadyPriority = portGET_HIGHEST_PRIORITY();
    #else
        // 遍历就绪列表查找
        listGET_OWNER_OF_NEXT_ENTRY( pxCurrentTCB, 
                                   &amp;( pxReadyTasksLists[ uxTopReadyPriority ] ) );
    #endif
}
</code></pre>
<p><strong>阶段四：恢复新任务上下文</strong></p>
<pre><code class="language-assembly">    /* 恢复新任务状态 */
    ldr r1, =pxCurrentTCB      // 获取新任务的 TCB
    ldr r0, [r1]
    ldr r0, [r0]               // 获取新任务的堆栈指针

    // 从堆栈恢复寄存器 r4-r11
    ldmia r0!, {r4-r11}

    // 更新进程堆栈指针
    msr psp, r0
    isb

    // 返回到新任务继续执行
    bx r14
</code></pre>
<h2 id="tcb">任务控制块（TCB）的关键作用</h2>
<h3 id="tcb_1">TCB 数据结构</h3>
<pre><code class="language-c">typedef struct tskTaskControlBlock
{
    // 堆栈管理
    volatile StackType_t *pxTopOfStack;    // 当前堆栈顶
    StackType_t *pxStack;                  // 堆栈起始地址

    // 任务状态管理
    ListItem_t xStateListItem;             // 状态列表项
    UBaseType_t uxPriority;                // 任务优先级
    StackType_t *pxEndOfStack;             // 堆栈结束地址

    // 任务标识
    char pcTaskName[ configMAX_TASK_NAME_LEN ];

    // 调试和跟踪信息
    #if ( configUSE_TRACE_FACILITY == 1 )
        UBaseType_t uxTCBNumber;
    #endif

    // 互斥量继承相关
    #if ( configUSE_MUTEXES == 1 )
        UBaseType_t uxBasePriority;
        UBaseType_t uxMutexesHeld;
    #endif
} tskTCB;
</code></pre>
<h3 id="_21">堆栈布局设计</h3>
<pre><code>任务堆栈在上下文保存后的布局：
高地址 -&gt; | 异常自动保存的寄存器(自动压栈，自动出栈) |
         | R0-R3, R12, LR, PC, xPSR |
         |---------------------------|
         | 手动保存的寄存器 R4-R11 (手动压栈，手动出栈)  | &lt;- PSP 指向这里
         |---------------------------|
         | 任务局部变量和调用栈      |
低地址 -&gt; | 堆栈起始位置            |
</code></pre>
<h2 id="_22">时间片轮转调度原理</h2>
<h3 id="_23">同优先级任务调度</h3>
<pre><code class="language-c">// 在 SysTick 中断中处理时间片
BaseType_t xTaskIncrementTick( void )
{
    TickType_t xSwitchRequired = pdFALSE;

    if( xSchedulerRunning != pdFALSE )
    {
        // 更新系统节拍计数
        const TickType_t xConstTickCount = xTickCount + 1;
        xTickCount = xConstTickCount;

        // 检查是否有任务超时
        if( xConstTickCount == 0 )
        {
            taskSWITCH_DELAYED_LISTS();
        }

        // 时间片轮转决策
        #if ( configUSE_PREEMPTION == 1 ) &amp;&amp; ( configUSE_TIME_SLICING == 1 )
        {
            // 如果当前优先级有多个就绪任务，触发切换
            if( listCURRENT_LIST_LENGTH( 
                &amp;( pxReadyTasksLists[ pxCurrentTCB-&gt;uxPriority ] ) ) &gt; ( UBaseType_t ) 1 )
            {
                xSwitchRequired = pdTRUE;
            }
        }
        #endif
    }

    return xSwitchRequired;
}
</code></pre>
<h2 id="_24">性能优化技术</h2>
<h3 id="_25">快速任务选择算法</h3>
<p><strong>位图调度算法：</strong></p>
<pre><code class="language-c">#if configUSE_PORT_OPTIMISED_TASK_SELECTION == 1

// 使用前导零计数指令快速找到最高优先级
#define portGET_HIGHEST_PRIORITY( uxTopPriority, uxReadyPriorities ) \
    __asm volatile( &quot;clz %0, %1&quot; : &quot;=r&quot; ( uxTopPriority ) : &quot;r&quot; ( uxReadyPriorities ) )

#endif
</code></pre>
<p><strong>惰性堆栈保存：</strong>
- 只保存被调用者保存的寄存器（R4-R11）
- 调用者保存的寄存器（R0-R3, R12）由 C-ABI 保证
- 硬件自动保存异常帧（R0-R3, R12, LR, PC, PSR）</p>
<h3 id="_26">中断延迟优化</h3>
<p><strong>PendSV 的低优先级设计：</strong></p>
<pre><code class="language-c">// PendSV 设置为最低优先级，确保：
// 1. 高优先级中断可以立即响应
// 2. 多个中断可以合并处理
// 3. 减少不必要的上下文切换

#define portPendSVHandler_PRIORITY ( 255UL &lt;&lt; 16UL )
</code></pre>
<h2 id="_27">实际应用场景分析</h2>
<h3 id="_28">场景一：高优先级任务抢占</h3>
<pre><code class="language-c">void vHighPriorityTask( void *pvParameters )
{
    for( ;; )
    {
        // 等待事件
        xQueueReceive( xHighPriorityQueue, ... );

        // 立即抢占当前运行的低优先级任务
        process_critical_work();
    }
}

void vLowPriorityTask( void *pvParameters )
{
    for( ;; )
    {
        // 执行非关键工作
        background_processing();

        // 可能在任何时刻被高优先级任务抢占
        taskYIELD();
    }
}
</code></pre>
<h3 id="_29">场景二：资源共享与同步</h3>
<pre><code class="language-c">void vProducerTask( void *pvParameters )
{
    for( ;; )
    {
        // 生产数据
        generate_data();

        // 发送数据到队列，可能唤醒消费者任务
        xQueueSend( xDataQueue, &amp;data, portMAX_DELAY );

        // 如果消费者优先级更高，会发生任务切换
    }
}

void vConsumerTask( void *pvParameters )
{
    for( ;; )
    {
        // 等待数据，如果没有数据会阻塞
        xQueueReceive( xDataQueue, &amp;data, portMAX_DELAY );

        // 被生产者唤醒后继续执行
        process_data( data );
    }
}
</code></pre>
<h2 id="_30">调试与性能分析</h2>
<h3 id="_31">上下文切换开销测量</h3>
<pre><code class="language-c">// 测量切换时间的简单方法
uint32_t measure_switch_time( void )
{
    uint32_t start_time, end_time;

    // 获取开始时间
    start_time = DWT-&gt;CYCCNT;

    // 触发任务切换
    taskYIELD();

    // 获取结束时间
    end_time = DWT-&gt;CYCCNT;

    return end_time - start_time;
}
</code></pre>
<h3 id="_32">常见问题与解决方案</h3>
<p><strong>问题一：过多的上下文切换</strong>
- 症状：CPU 大部分时间在切换任务而非执行任务
- 解决方案：调整时间片大小，合并小任务</p>
<p><strong>问题二：优先级反转</strong>
- 症状：高优先级任务被低优先级任务阻塞
- 解决方案：使用优先级继承协议或优先级天花板</p>
<p><strong>问题三：堆栈溢出</strong>
- 症状：任务崩溃或系统不稳定
- 解决方案：增加堆栈大小，使用堆栈检查功能</p>
<h1 id="api">其他API函数</h1>
<h3 id="freertos_3">FreeRTOS</h3>
<p>这些函数以 <code>vTask</code>、<code>xTask</code> 等为前缀，是 FreeRTOS 内核的直接接口。</p>
<table>
<thead>
<tr>
<th style="text-align: left;">分类</th>
<th style="text-align: left;">函数名</th>
<th style="text-align: left;">功能描述</th>
<th style="text-align: left;">参数说明</th>
<th style="text-align: left;">返回值/注意事项</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>taskYIELD()</code></td>
<td style="text-align: left;">主动请求任务切换（强制调度）。</td>
<td style="text-align: left;">无</td>
<td style="text-align: left;">是一个宏，通常触发 PendSV 异常。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>优先级管理</strong></td>
<td style="text-align: left;"><code>vTaskPrioritySet()</code></td>
<td style="text-align: left;">设置任务的优先级。</td>
<td style="text-align: left;"><code>xTask</code>: 任务句柄<br><code>uxNewPriority</code>: 新的优先级</td>
<td style="text-align: left;">优先级必须在 <code>0</code> 到 <code>configMAX_PRIORITIES-1</code> 范围内。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>uxTaskPriorityGet()</code></td>
<td style="text-align: left;">获取任务的当前优先级。</td>
<td style="text-align: left;"><code>xTask</code>: 任务句柄</td>
<td style="text-align: left;">返回任务的当前优先级。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>状态查询</strong></td>
<td style="text-align: left;"><code>eTaskGetState()</code></td>
<td style="text-align: left;">获取任务的状态（运行、就绪、阻塞、挂起、删除）。</td>
<td style="text-align: left;"><code>xTask</code>: 任务句柄</td>
<td style="text-align: left;">返回一个 <code>eTaskState</code> 枚举值。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>uxTaskGetStackHighWaterMark()</code></td>
<td style="text-align: left;">获取任务堆栈的历史最小剩余空间（高水位线）。</td>
<td style="text-align: left;"><code>xTask</code>: 任务句柄</td>
<td style="text-align: left;">返回值越小，说明堆栈使用率越高。0 表示堆栈已溢出。用于评估堆栈大小是否合理。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>其他</strong></td>
<td style="text-align: left;"><code>pcTaskGetName()</code></td>
<td style="text-align: left;">获取任务的名称字符串。</td>
<td style="text-align: left;"><code>xTaskToQuery</code>: 任务句柄</td>
<td style="text-align: left;">返回任务名称字符串的指针。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>xTaskGetTickCount()</code></td>
<td style="text-align: left;">获取系统节拍计数器自启动以来的值。</td>
<td style="text-align: left;">无</td>
<td style="text-align: left;">在任务中使用。注意节拍计数器溢出。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>xTaskGetTickCountFromISR()</code></td>
<td style="text-align: left;">在中断服务程序中获取系统节拍计数器。</td>
<td style="text-align: left;">无</td>
<td style="text-align: left;">在 ISR 中使用。</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="cmsis-rtos-v2">CMSIS-RTOS v2</h2>
<p>这些函数以 <code>osThread</code> 为前缀，是 FreeRTOS 原生 API 的封装，提供了标准化的接口。</p>
<table>
<thead>
<tr>
<th style="text-align: left;">分类</th>
<th style="text-align: left;">函数名</th>
<th style="text-align: left;">功能描述</th>
<th style="text-align: left;">参数说明</th>
<th style="text-align: left;">返回值/注意事项</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>osThreadGetId()</code></td>
<td style="text-align: left;">获取当前正在运行的线程的 ID。</td>
<td style="text-align: left;">无</td>
<td style="text-align: left;">返回当前线程的 ID。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>osThreadGetName()</code></td>
<td style="text-align: left;">获取指定线程的名称字符串。</td>
<td style="text-align: left;"><code>thread_id</code>: 线程 ID</td>
<td style="text-align: left;">返回线程名称字符串的指针。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>任务控制</strong></td>
<td style="text-align: left;"><code>osDelay()</code></td>
<td style="text-align: left;">将当前线程延迟（阻塞）指定的时间。</td>
<td style="text-align: left;"><code>ticks</code>: 延迟的时间节拍数</td>
<td style="text-align: left;">相当于 FreeRTOS 的 <code>vTaskDelay</code>。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>osDelayUntil()</code></td>
<td style="text-align: left;">精确的周期性延迟。</td>
<td style="text-align: left;"><code>ticks</code>: 下一次唤醒的绝对节拍时间</td>
<td style="text-align: left;">相当于 FreeRTOS 的 <code>vTaskDelayUntil</code>。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>osThreadYield()</code></td>
<td style="text-align: left;">将 CPU 控制权交给另一个就绪态的同优先级线程。</td>
<td style="text-align: left;">无</td>
<td style="text-align: left;">相当于 FreeRTOS 的 <code>taskYIELD()</code>。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>状态与优先级</strong></td>
<td style="text-align: left;"><code>osThreadGetState()</code></td>
<td style="text-align: left;">获取当前线程的状态。</td>
<td style="text-align: left;"><code>thread_id</code>: 线程 ID</td>
<td style="text-align: left;">返回一个 <code>osThreadState_t</code> 枚举值（就绪、运行、阻塞、终止等）。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>osThreadSetPriority()</code></td>
<td style="text-align: left;">设置指定线程的优先级。</td>
<td style="text-align: left;"><code>thread_id</code>: 线程 ID<br><code>priority</code>: 新的优先级</td>
<td style="text-align: left;">优先级在 <code>osPriority_t</code> 枚举中定义。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>osThreadGetPriority()</code></td>
<td style="text-align: left;">获取指定线程的当前优先级。</td>
<td style="text-align: left;"><code>thread_id</code>: 线程 ID</td>
<td style="text-align: left;">返回线程的当前优先级。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>系统信息</strong></td>
<td style="text-align: left;"><code>osThreadGetStackSpace()</code></td>
<td style="text-align: left;">（可选）获取线程的剩余堆栈空间。</td>
<td style="text-align: left;"><code>thread_id</code>: 线程 ID</td>
<td style="text-align: left;">返回值依赖于具体实现，可能返回字节数或字数的剩余空间。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>osKernelGetTickCount()</code></td>
<td style="text-align: left;">获取内核节拍计数器。</td>
<td style="text-align: left;">无</td>
<td style="text-align: left;">相当于 FreeRTOS 的 <code>xTaskGetTickCount</code>，可在任务和中断中使用。</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"><code>osKernelGetSysTimerCount()</code></td>
<td style="text-align: left;">获取系统计时器的精确计数值。</td>
<td style="text-align: left;">无</td>
<td style="text-align: left;">用于高精度时间测量。</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Your Name
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.expand", "navigation.indexes", "search.suggest", "search.highlight"], "search": "../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>