<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>栈 - 个人技术与学习笔记</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u6808";
        var mkdocs_page_input_path = "\u7535\u8d5b\u8f6f\u4ef6/\u6c47\u7f16\u5165\u95e8/\u6808.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> 个人技术与学习笔记
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">首页</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">机器学习 (Machine Learning)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Pytorch 学习</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/nn/">nn 神经网络</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/tensor/">Tensor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/data/">data 数据处理</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/transfrom/">transform</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/tensorboard/">tensorboard 可视化</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Pytorch_Learning/Test/">Test Notebook</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">电赛软件 (Embedded Software)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../%E7%94%B5%E8%B5%9B%E8%BD%AF%E4%BB%B6/">简介</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >ARM 架构</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ARM%E6%9E%B6%E6%9E%84/ARM%E6%9E%B6%E6%9E%84/">ARM 架构概述</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ARM%E6%9E%B6%E6%9E%84/ARM%20Cortex-M%20CPU%20%E6%9E%B6%E6%9E%84/">ARM Cortex-M CPU 架构</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ARM%E6%9E%B6%E6%9E%84/%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8/">通用寄存器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ARM%E6%9E%B6%E6%9E%84/%E7%89%B9%E6%AE%8A%E5%AF%84%E5%AD%98%E5%99%A8xPSR/">特殊寄存器xPSR</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >RTOS 实时操作系统</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../RTOS/RTOS/">简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../RTOS/%E4%BB%BB%E5%8A%A1%E5%A0%86%E6%A0%88/">任务堆栈</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../RTOS/%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/">任务切换</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >FreeRTOS</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/FreeRTOS.md">FreeRTOS 简介</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/任务创建和删除.md">任务创建和删除</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/任务调度.md">任务调度</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/任务通知.md">任务通知</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/内存管理.md">内存管理</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/同步、互斥与通信.md">同步、互斥与通信</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/队列.md">队列</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/队列集.md">队列集</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/中断管理.md">中断管理</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../电赛软件/RTOS/FreeRTOS/移植.md">移植</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >STM32 HAL 库</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/STM32%20HAL%E5%BA%93/">库介绍</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/GPIO%E6%93%8D%E4%BD%9C/">GPIO 操作</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/NVIC/">NVIC</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/DMA/">DMA</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/ADC/">ADC</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/%E5%AE%9A%E6%97%B6%E5%99%A8/">定时器</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/FLASH/">FLASH</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/BKP%26RTC/">BKP & RTC</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/WDG/">WDG</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../STM32%20HAL%E5%BA%93/%E7%A1%AC%E4%BB%B6%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/">硬件通信协议</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >通信协议</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/">简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/I2C/">I2C</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/SPI/">SPI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/USART/">USART</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/CAN/">CAN</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >电控算法</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/">简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/PID/">PID</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/LQR/">LQR</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../%E7%94%B5%E6%8E%A7%E7%AE%97%E6%B3%95/SMC/">SMC</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >视觉应用</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../%E8%A7%86%E8%A7%89/%E8%A7%86%E8%A7%89/">视觉</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../%E8%A7%86%E8%A7%89/Micropython%20%26%20K230/">Micropython & K230</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">个人技术与学习笔记</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">栈</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1">栈</h1>
<p>栈是<strong>内存中</strong>的一块特殊区域，采用<strong>后进先出</strong>的原则管理数据，主要用于函数调用、局部变量存储和现场保护。</p>
<h1 id="_2">栈的核心特性</h1>
<h2 id="_3">生长方向</h2>
<ul>
<li><strong>向下生长</strong>：栈从高地址向低地址扩展</li>
<li><strong>栈指针(SP)</strong>：始终指向栈顶位置</li>
</ul>
<pre><code>高地址 → 栈底 (初始SP)
        │
        │ 已使用栈空间
        │
        ↓ 栈顶 (当前SP) 
低地址 → 未使用空间
</code></pre>
<h1 id="_4">栈的基本操作</h1>
<h2 id="push-">PUSH - 压栈</h2>
<pre><code class="language-assembly">PUSH {R0, R1, LR}    ; SP减少，数据存入栈中
</code></pre>
<p><strong>执行过程：</strong>
1. SP = SP - 12 (3个寄存器 × 4字节)
2. 数据按顺序存入栈中</p>
<h2 id="pop-">POP - 出栈</h2>
<pre><code class="language-assembly">POP {R0, R1, PC}     ; 数据从栈中恢复，SP增加
</code></pre>
<h1 id="_5">栈在函数调用中的作用</h1>
<h2 id="_6">函数开场</h2>
<pre><code class="language-assembly">my_function:
    PUSH {R4, R5, LR}    ; 保存现场
    SUB SP, SP, #8       ; 分配局部变量空间
</code></pre>
<h2 id="_7">栈帧布局</h2>
<pre><code>┌─────────────┐ ← 旧SP
│    旧LR     │
├─────────────┤
│     R5      │
├─────────────┤
│     R4      │
├─────────────┤ ← 当前SP
│ 局部变量2   │
├─────────────┤
│ 局部变量1   │
└─────────────┘ ← 新SP
</code></pre>
<h2 id="_8">函数退场</h2>
<pre><code class="language-assembly">    ADD SP, SP, #8       ; 释放局部变量空间
    POP {R4, R5, PC}     ; 恢复现场并返回
</code></pre>
<h1 id="_9">栈的用途</h1>
<ol>
<li><strong>保存返回地址</strong>：LR寄存器压栈</li>
<li><strong>保护寄存器</strong>：防止被调用函数破坏调用者的数据</li>
<li><strong>局部变量存储</strong>：函数内的自动变量</li>
<li><strong>参数传递</strong>：当寄存器不够时通过栈传递</li>
<li><strong>中断处理</strong>：保存处理器状态</li>
</ol>
<h1 id="_10">栈指针操作</h1>
<h2 id="_11">显式调整</h2>
<pre><code class="language-assembly">SUB SP, SP, #16     ; 分配16字节栈空间
ADD SP, SP, #16     ; 释放栈空间
</code></pre>
<h2 id="_12">隐式调整</h2>
<pre><code class="language-assembly">PUSH {R0-R3}        ; 自动 SP = SP - 16
POP {R0-R3}         ; 自动 SP = SP + 16
</code></pre>
<h1 id="_13">重要特点</h1>
<ul>
<li><strong>自动管理</strong>：编译器自动生成栈操作指令</li>
<li><strong>后进先出</strong>：最后压入的数据最先弹出</li>
<li><strong>线程私有</strong>：每个线程有自己的栈空间</li>
<li><strong>大小有限</strong>：栈溢出会导致程序崩溃</li>
</ul>
<h1 id="vs">栈 vs 栈帧</h1>
<h2 id="_14">核心区别</h2>
<table>
<thead>
<tr>
<th>特性</th>
<th>栈 (Stack)</th>
<th>栈帧 (Stack Frame)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>数量</strong></td>
<td>每个线程一个栈</td>
<td>每个函数调用一个栈帧</td>
</tr>
<tr>
<td><strong>生命周期</strong></td>
<td>线程整个生命周期</td>
<td>函数调用期间</td>
</tr>
<tr>
<td><strong>大小</strong></td>
<td>较大 (通常几MB)</td>
<td>较小 (几十到几百字节)</td>
</tr>
<tr>
<td><strong>用途</strong></td>
<td>所有函数调用的总容器</td>
<td>单个函数的局部工作区</td>
</tr>
</tbody>
</table>
<h2 id="_15">详细解释</h2>
<h3 id="stack-">栈 (Stack) - "整栋大楼"</h3>
<ul>
<li><strong>一个完整的记忆区域</strong>，就像一栋办公大楼</li>
<li><strong>每个线程有自己的栈</strong></li>
<li><strong>从高地址向低地址生长</strong></li>
<li><strong>包含所有函数调用的栈帧</strong></li>
</ul>
<h3 id="stack-frame-">栈帧 (Stack Frame) - "单个办公室"</h3>
<ul>
<li><strong>函数调用时创建的临时工作区</strong>，就像大楼里的一个办公室</li>
<li><strong>每个函数调用都有独立的栈帧</strong></li>
<li><strong>包含该函数的局部变量、参数、返回地址等</strong></li>
<li><strong>函数返回时"退房"，栈帧被释放</strong></li>
</ul>
<h2 id="_16">实际内存布局</h2>
<h3 id="_17">多个函数调用时的栈结构</h3>
<pre><code>高地址 → ┌─────────────┐ ← 栈底
         │  main函数   │ ← main的栈帧
         │   栈帧      │
         ├─────────────┤
         │  funcA函数  │ ← funcA的栈帧  
         │   栈帧      │
         ├─────────────┤
         │  funcB函数  │ ← funcB的栈帧
         │   栈帧      │
         ├─────────────┤
         │  funcC函数  │ ← funcC的栈帧
         │   栈帧      │
低地址 → └─────────────┘ ← 当前SP (栈顶)
</code></pre>
<h2 id="_18">具体示例分析</h2>
<h3 id="c">C代码示例</h3>
<pre><code class="language-c">int funcC(int x) {
    int local_c = x + 5;
    return local_c;
}

int funcB(int a) {
    int local_b = a * 2;
    return funcC(local_b);
}

int funcA() {
    int local_a = 10;
    return funcB(local_a);
}
</code></pre>
<h3 id="_19">栈帧创建过程</h3>
<pre><code class="language-assembly">main:
    BL funcA           ; 调用funcA

funcA:
    PUSH {R4, LR}      ; 创建funcA的栈帧
    SUB SP, SP, #8     ; 为局部变量分配空间
    MOV R4, #10
    STR R4, [SP, #4]   ; local_a = 10
    BL funcB           ; 调用funcB
    ADD SP, SP, #8     ; 释放funcA栈帧的局部变量
    POP {R4, PC}       ; 释放funcA栈帧

funcB:
    PUSH {R4, LR}      ; 在funcA栈帧之上创建funcB栈帧
    SUB SP, SP, #8
    ; ... funcB的代码 ...
    BL funcC           ; 调用funcC
    ADD SP, SP, #8
    POP {R4, PC}

funcC:
    PUSH {R4, LR}      ; 在funcB栈帧之上创建funcC栈帧
    SUB SP, SP, #8
    ; ... funcC的代码 ...
    ADD SP, SP, #8
    POP {R4, PC}       ; 释放funcC栈帧
</code></pre>
<h2 id="_20">栈帧的典型内容</h2>
<h3 id="_21">单个栈帧的内部结构</h3>
<pre><code>┌─────────────┐ ← 帧指针 (FP/R11)
│  调用者FP   │ ← 前一个栈帧的帧指针
├─────────────┤
│  返回地址   │ ← 函数返回后继续执行的位置
├─────────────┤
│  保存的R4   │ ← 被调用者保存的寄存器
│  保存的R5   │
│  保存的LR   │
├─────────────┤ ← 栈指针 (SP) 进入时
│  参数5+     │ ← 多余的参数（如果有）
├─────────────┤
│ 局部变量1   │ ← 函数的自动变量
│ 局部变量2   │
├─────────────┤ ← 当前SP (函数执行中)
│    空余     │ ← 可能用于临时存储
└─────────────┘
</code></pre>
<h2 id="_22">关键特点</h2>
<h3 id="_23">栈的特点</h3>
<ul>
<li><strong>后进先出 (LIFO)</strong>：最后调用的函数最先返回</li>
<li><strong>自动管理</strong>：编译器生成栈操作代码</li>
<li><strong>大小固定</strong>：栈溢出会导致程序崩溃</li>
</ul>
<h3 id="_24">栈帧的特点</h3>
<ul>
<li><strong>嵌套结构</strong>：栈帧在栈内嵌套排列</li>
<li><strong>动态创建/销毁</strong>：函数调用时创建，返回时销毁</li>
<li><strong>独立空间</strong>：每个栈帧内的变量相互隔离</li>
</ul>
<h2 id="_25">总结</h2>
<p><strong>简单比喻</strong>：
- <strong>栈</strong> = 一整栋办公大楼
- <strong>栈帧</strong> = 大楼里的单个办公室</p>
<p><strong>所有函数共享同一个栈，但每个函数调用都有自己独立的栈帧！</strong></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy; 2025 马梓腾</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
